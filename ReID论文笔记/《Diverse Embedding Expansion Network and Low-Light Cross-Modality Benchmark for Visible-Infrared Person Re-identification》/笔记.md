# 模型架构

![](E:\Markdown\ReID论文笔记\《Diverse Embedding Expansion Network and Low-Light Cross-Modality Benchmark for Visible-Infrared Person Re-identification》\img1.png)

## Diverse Embedding Expansion Module

---

### 1. DEE Module的概述
- **目标**：DEE Module通过**多分支卷积结构**生成多样化的嵌入（embeddings），并结合**中心引导对挖掘损失（CPM Loss）**优化这些嵌入，使其能够有效学习跨模态的特征表示，<u>减少可见光（VIS）和红外（IR）图像之间的模态差异。</u>
- **位置**：DEE Module通常插入到骨干网络（如ResNet-50）的某个阶段（文献实验表明最佳位置是Stage-3），从该阶段提取特征作为输入。
- **输出**：生成增强的特征$$ ( f_+ )$$，并将其送回骨干网络的下一阶段继续处理。

---

### 2. DEE Module的详细结构
根据文献和图示，DEE Module采用多分支卷积生成结构，具体包括以下组件：

#### 2.1 输入特征
- **输入**：从骨干网络的某一阶段（例如Stage-3）提取的特征$$ ( f )$$，这是一个三维张量，通常表示为，$$ ( C \times H \times W )$$其中 $$( C ) $$是通道数，$$( H ) $$和 $$( W )$$ 是高度和宽度。
- **来源**：$$( f ) $$是骨干网络处理输入图像（VIS或IR）后生成的中间特征。

#### 2.2 多分支卷积生成
- **分支数量**：文献提到DEE使用多分支结构，实验中测试了2、3、4个分支，最终选择3个分支作为最佳配置（见Table 6）。Figure 3显示了三个并行分支。
- **每个分支的处理**：
  - **膨胀卷积层**：每个分支包含三个$$ ( 3 \times 3 ) $$膨胀卷积层（dilated convolutions），膨胀率（dilation rates）分别为1、2、3。这些层用于扩展感受野，捕获多尺度特征。
    - 文献中描述为 \( \varphi_{3 \times 3}^1 \)、\( \varphi_{3 \times 3}^2 \)、\( \varphi_{3 \times 3}^3 \)。
    - 这些卷积层将输入特征 \( f \) 的通道数减少到原先的1/4，同时保持空间分辨率。
  - **特征融合**：三个膨胀卷积层的输出通过某种方式（可能是逐元素相加或拼接）组合成一个单一特征图。
  - **ReLU激活**：应用ReLU激活层 \( \mathbf{F}_{ReLU} \) 增强非线性表示能力。
  - **\( 1 \times 1 \) 卷积层**：使用 \( \theta_{1 \times 1} \) 卷积层调整特征图的通道数，使其维度与输入 \( f \) 一致。
- **分支输出**：每个分支生成一个增强特征 \( f_+^i \)（其中 \( i \) 表示第 \( i \) 个分支，例如 \( i = 1, 2, 3 \)）。

#### 2.3 特征拼接
- **拼接操作**：所有分支的输出 \( \{f_+^1, f_+^2, f_+^3\} \) 沿着通道维度进行拼接（concatenation），生成最终的增强特征 \( f_+ \)。
- **维度变化**：如果每个分支的输出通道数与 \( f \) 相同，则 \( f_+ \) 的通道数将是 \( f \) 的3倍（假设3个分支），但文献提到通道数减少到1/4后再调整回原维度，实际拼接后可能通过进一步处理保持一致性。

#### 2.4 输出
- **送回骨干网络**：增强特征 \( f_+ \) 被送回ResNet-50的下一阶段（例如Stage-4）继续处理，最终通过全局平均池化（GAP）和批归一化（BN）层映射到嵌入空间。

---

### 3. 完整的处理流程
以下是DEE Module的详细处理流程，结合文献公式和Figure 3的图形表示：

1. **输入特征提取**：
   - 从骨干网络Stage-3输出特征 \( f \in \mathbb{R}^{C \times H \times W} \)，这是输入图像经过卷积和池化后的中间表示。

2. **多分支处理**：
   - **分支1**：
     - 输入 \( f \) 经过 \( \varphi_{3 \times 3}^1 \)（膨胀率1）卷积，通道数减少到 \( C/4 \)。
     - 依次经过 \( \varphi_{3 \times 3}^2 \)（膨胀率2）和 \( \varphi_{3 \times 3}^3 \)（膨胀率3）卷积，进一步提取多尺度特征。
     - 输出特征图通过ReLU激活 \( \mathbf{F}_{ReLU} \) 增强非线性。
     - 应用 \( \theta_{1 \times 1} \) 卷积层，将通道数调整回 \( C \)，生成 \( f_+^1 \)。
   - **分支2和3**：类似分支1，分别使用不同的膨胀卷积组合，生成 \( f_+^2 \) 和 \( f_+^3 \)。
   - Figure 3中用并行箭头和卷积核（\( 3 \times 3 \) 和 \( 1 \times 1 \)）表示这三个分支。

3. **特征融合**：
   - 将 \( f_+^1 \)、\( f_+^2 \)、\( f_+^3 \) 沿着通道维度拼接，生成 \( f_+ \in \mathbb{R}^{3C \times H \times W} \)（假设未进一步降维）。
   - 文献提到“combining them into one feature map”，可能是指在拼接后应用额外的卷积或池化层，确保 \( f_+ \) 的维度与骨干网络兼容。

4. **输出与反馈**：
   - \( f_+ \) 作为增强特征送回Stage-4，参与后续处理。
   - 最终，网络通过GAP和BN层将所有阶段的特征映射到嵌入空间，生成最终的VIS、IR和多样化嵌入。

#### 3.1 数学表达
文献中给出了生成的嵌入的数学形式（见3.2节）：
- 对于第 \( i \) 个分支，生成的嵌入 \( f_+^i \) 可以表示为：
  \[
  f_+^i = \theta_{1 \times 1} \left( \mathbf{F}_{ReLU} \left( \varphi_{3 \times 3}^3 \left( \varphi_{3 \times 3}^2 \left( \varphi_{3 \times 3}^1 (f) \right) \right) \right) \right)
  \]
  其中，\( \varphi_{3 \times 3}^k \) 表示膨胀率为 \( k \) 的卷积层，\( \theta_{1 \times 1} \) 是通道调整层。
- 所有分支的输出拼接为：
  \[
  f_+ = \text{Concat}(f_+^1, f_+^2, f_+^3)
  \]

#### 3.2 约束与优化
- **正交损失 $$(( \mathcal{L}_{ort} ))$$**：
  
  - 文献中提到，为了确保不同分支的嵌入捕获不同信息，应用正交损失：
    $$
    
    \mathcal{L}_{ort} = \sum_{m=1}^{J-1} \sum_{n=m+1}^J (f_+^{mT} f_+^n)
    $$
    其中 \( f_+^m \) 和 \( f_+^n \) 是不同分支的嵌入，\( J \) 是分支数（例如3）。这一损失最小化嵌入之间的内积，鼓励正交性。
- **CPM损失 (\( \mathcal{L}_{cpm} \))**：
  - 中心引导对挖掘损失通过三条性质约束嵌入（见3.3节）：
    - 嵌入应多样化（推开生成的嵌入与原始嵌入的距离）。
    - 减少模态差异（拉近VIS生成的嵌入与IR嵌入，反之亦然）。
    - 保持类内距离小于类间距离。
  - 损失公式为：
    \[
    \mathcal{L}_{cpm} = \mathcal{L}(\mathbf{c}_v, \mathbf{c}_n, \mathbf{c}_{v+1}^i) + \mathcal{L}(\mathbf{c}_v, \mathbf{c}_n, \mathbf{c}_{n+1}^i)
    \]
    其中 \( \mathbf{c}_v \)、\( \mathbf{c}_n \) 是VIS和IR的类中心，\( \mathbf{c}_{v+1}^i \) 是生成的嵌入类中心。

---

### 4. 流程图解 (基于Figure 3)
- **输入**：特征 \( f \) 从骨干网络进入DEE Module。
- **分支处理**：三个并行分支，每分支包含三层 \( 3 \times 3 \) 膨胀卷积（膨胀率1、2、3）和一层 \( 1 \times 1 \) 卷积，中间有ReLU激活。
- **拼接**：分支输出拼接成 \( f_+ \)。
- **输出**：\( f_+ \) 送回骨干网络，参与后续嵌入生成。

---

### 5. 工作机制与意义
- **多样性**：多分支和正交损失确保生成的嵌入包含不同信息，增强特征表示能力。
- **模态对齐**：CPM损失拉近VIS和IR嵌入的距离，解决模态差异问题。
- **应用**：生成的 \( f_+ \) 丰富了嵌入空间，最终提升了VIReID的检索性能（见文献Table 2和Table 3）。

---

